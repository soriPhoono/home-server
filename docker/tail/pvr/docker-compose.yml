x-common:
  server-config: &server-config
    TZ: America/Chicago
    PUID: 1000
    PGID: 1000
services:
  sonarr:
    image: linuxserver/sonarr
    container_name: sonarr
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8989/ || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 30s
    volumes:
      - sonarr-config:/config
      - /mnt/data/media/Shows:/shows
      - /mnt/data/media/Torrent:/downloads
    environment:
      !!merge <<: *server-config
    networks:
      - core_traefik-public
    logging:
      driver: loki
      options:
        loki-url: http://localhost:3100/loki/api/v1/push
    labels:
      - traefik.enable=true
      - traefik.http.routers.sonarr.rule=Host(`pvr.ts.${DOMAIN_NAME}`) && PathPrefix(`/shows`)
      - traefik.http.routers.sonarr.entrypoints=websecure
      - traefik.http.routers.sonarr.tls=true
      - traefik.http.routers.sonarr.tls.certresolver=cf-ts
      - traefik.http.services.sonarr.loadbalancer.server.port=8989
  radarr:
    image: linuxserver/radarr
    container_name: radarr
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:7878/ || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 30s
    volumes:
      - radarr-config:/config
      - /mnt/data/media/Movies:/movies
      - /mnt/data/media/Torrent:/downloads
    environment:
      !!merge <<: *server-config
    networks:
      - core_traefik-public
    logging:
      driver: loki
      options:
        loki-url: http://localhost:3100/loki/api/v1/push
    labels:
      - traefik.enable=true
      - traefik.http.routers.radarr.rule=Host(`pvr.ts.${DOMAIN_NAME}`) && PathPrefix(`/movies`)
      - traefik.http.routers.radarr.entrypoints=websecure
      - traefik.http.routers.radarr.tls=true
      - traefik.http.routers.radarr.tls.certresolver=cf-ts
      - traefik.http.services.radarr.loadbalancer.server.port=7878
  jellyfin:
    image: linuxserver/jellyfin
    container_name: jellyfin
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8096/ || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 30s
    devices:
      - /dev/dri:/dev/dri
    volumes:
      - jellyfin-config:/config
      - /mnt/data/media/Movies:/movies
      - /mnt/data/media/Shows:/shows
    environment:
      !!merge <<: *server-config
    networks:
      - core_traefik-public
    logging:
      driver: loki
      options:
        loki-url: http://localhost:3100/loki/api/v1/push
    labels:
      - traefik.enable=true
      - traefik.http.routers.jellyfin.rule=Host(`pvr.ts.${DOMAIN_NAME}`) && PathPrefix(`/watch`)
      - traefik.http.routers.jellyfin.entrypoints=websecure
      - traefik.http.routers.jellyfin.tls=true
      - traefik.http.routers.jellyfin.tls.certresolver=cf-ts
      - traefik.http.services.jellyfin.loadbalancer.server.port=8096
  jellyseerr:
    image: fallenbagel/jellyseerr
    container_name: jellyseerr
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "wget --spider -q http://localhost:5055/ || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 30s
    depends_on:
      sonarr:
        condition: service_healthy
      radarr:
        condition: service_healthy
      jellyfin:
        condition: service_healthy
    volumes:
      - jellyseerr-config:/app/config
    environment:
      - TZ=America/Chicago
    networks:
      - core_traefik-public
    logging:
      driver: loki
      options:
        loki-url: http://localhost:3100/loki/api/v1/push
    labels:
      - traefik.enable=true
      - traefik.http.routers.jellyseerr.rule=Host(`pvr.ts.${DOMAIN_NAME}`)
      - traefik.http.routers.jellyseerr.entrypoints=websecure
      - traefik.http.routers.jellyseerr.tls=true
      - traefik.http.routers.jellyseerr.tls.certresolver=cf-ts
      - traefik.http.services.jellyseerr.loadbalancer.server.port=5055
volumes:
  sonarr-config:
  radarr-config:
  jellyfin-config:
  jellyseerr-config:
networks:
  core_traefik-public:
    external: true
